-----------------------------------------------------------------------------------------------------------------------------------------
-- VRP
-----------------------------------------------------------------------------------------------------------------------------------------
local Tunnel = module("vrp","lib/Tunnel")
local Proxy  = module("vrp","lib/Proxy")
local Tools  = module("vrp","lib/Tools")
vRP = Proxy.getInterface("vRP")
vRPclient = Tunnel.getInterface("vRP")
-----------------------------------------------------------------------------------------------------------------------------------------
-- variabless
-----------------------------------------------------------------------------------------------------------------------------------------
local blips = {}
-----------------------------------------------------------------------------------------------------------------------------------------
-- database set
-----------------------------------------------------------------------------------------------------------------------------------------
DB = {}

DB.prepare = function(name, query)
    vRP.prepare(name, query)
end

DB.execute = function(name, param)
    return vRP.execute(name, param)
end

DB.query = function(name, param)
    return vRP.query(name, param)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- getUserSource
-----------------------------------------------------------------------------------------------------------------------------------------
getUserSource = function(user_id)
    return vRP.getUserSource(tonumber(user_id))
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- getUserId
-----------------------------------------------------------------------------------------------------------------------------------------
getUserId = function(source)
    return vRP.getUserId(source)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- getUserIdentity
-----------------------------------------------------------------------------------------------------------------------------------------
getUserIdentity = function(user_id)
    return vRP.getUserIdentity(user_id)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- getUserFullName
-----------------------------------------------------------------------------------------------------------------------------------------
getUserFullName = function(user_id)
    local identity = getUserIdentity(user_id)
    local name = identity.name
    return name
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- getUserFines
-----------------------------------------------------------------------------------------------------------------------------------------
getUserFines = function(user_id)
    local fines = getUserData(user_id, "vRP:multas")
    if fines == "" then
        fines = 0
    end
    local text = "R$ "..fines
    return text
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- getUserFines
-----------------------------------------------------------------------------------------------------------------------------------------
getCoins = function(user_id)
    return tonumber(getUserData(user_id,"vRP:coins")) or 0
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- getProfission
-----------------------------------------------------------------------------------------------------------------------------------------
getProfission = function(user_id)
    local profission = 'Desempregado'
    local primary    = vRP.getUserGroupByType(user_id,'job')
    local hie        = vRP.getUserGroupByType(user_id,'hie')

    if primary ~= '' then
        profission = primary
    end

    if hie ~= '' then
        profission = hie
    end

    return profission
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- getVipName
-----------------------------------------------------------------------------------------------------------------------------------------
getVipName = function(user_id)
    local vip = vRP.getUserGroupByType(user_id,'pass')

    if vip == '' then
        vip = 'Nenhum'
    end

    return vip
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- getHasPermission
-----------------------------------------------------------------------------------------------------------------------------------------
getHasPermission = function(user_id, perm)
    return vRP.hasPermission(user_id,perm)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- getUsersByPermission
-----------------------------------------------------------------------------------------------------------------------------------------
getUsersByPermission = function(group)
    return vRP.getUsersByPermission(group)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- treatUsersByPermission
-----------------------------------------------------------------------------------------------------------------------------------------
treatUsersByPermission = function(id)
    local player = getUserSource(id)
    local user_id = getUserId(player)
    return player,user_id
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- getUserPosition
-----------------------------------------------------------------------------------------------------------------------------------------
getUserPosition = function(source)
    return vRPclient.getPosition(source)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- playSound
-----------------------------------------------------------------------------------------------------------------------------------------
playSound = function(source,dict,name)
    vRPclient.playSound(source,dict,name)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- createBlipTimeout
-----------------------------------------------------------------------------------------------------------------------------------------
createBlipTimeout = function(source,x,y,z,title,timeout)
    local idgens = Tools.newIDGenerator()
    local id     = idgens:gen()
    blips[id] = vRPclient.addBlip(source,x,y,z,10,5,title,0.5,true)
    SetTimeout(timeout,function() vRPclient.removeBlip(source,blips[id]) idgens:free(id) end)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- requestAcceptorNot
-----------------------------------------------------------------------------------------------------------------------------------------
requestAcceptorNot = function(source,title,timeout,otherplayer)
    return vRP.request(source,title,timeout,otherplayer)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- checkPlayerHandcuffed
-----------------------------------------------------------------------------------------------------------------------------------------
checkPlayerHandcuffed = function(source)
    return vRPclient.isHandcuffed(source)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- checkPlayerSearch
-----------------------------------------------------------------------------------------------------------------------------------------
checkPlayerSearch = function(user_id)
    return vRP.searchReturn(user_id)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- checkIsVip
-----------------------------------------------------------------------------------------------------------------------------------------
checkIsVip = function(user_id)
    local vip = vRP.getUserGroupByType(user_id,'pass')

    if vip ~= '' then
        return true
    end

    return false
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- getWeight
-----------------------------------------------------------------------------------------------------------------------------------------
getWeight = function(user_id)
    return vRP.getExp(user_id,"physical","strength")
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- addWeight
-----------------------------------------------------------------------------------------------------------------------------------------
addWeight = function(user_id, weight)
    vRP.varyExp(user_id,"physical","strength",weight)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- getBankMoney
-----------------------------------------------------------------------------------------------------------------------------------------
getBankMoney = function(user_id)
    return vRP.getBankMoney(user_id)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- addBankMoney
-----------------------------------------------------------------------------------------------------------------------------------------
addBankMoney = function(user_id, amount)
    local bank  = getBankMoney(user_id)
    local total = bank + amount
    vRP.setBankMoney(user_id, tonumber(total))
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- remBankMoney
-----------------------------------------------------------------------------------------------------------------------------------------
remBankMoney = function(user_id, amount)
    local bank  = getBankMoney(user_id)
    local total = bank - amount
    vRP.setBankMoney(user_id, tonumber(total))
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- getOwnerVehiclePlate
-----------------------------------------------------------------------------------------------------------------------------------------
getOwnerVehiclePlate = function(plate)
    return vRP.getUserByRegistration(plate)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- formatnumber
-----------------------------------------------------------------------------------------------------------------------------------------
formatnumber = function(number)
	local left,num,right = string.match(number,'^([^%d]*%d)(%d*)(.-)$')
	return left..(num:reverse():gsub('(%d%d%d)','%1.'):reverse())..right
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- getUserData
-----------------------------------------------------------------------------------------------------------------------------------------
getUserData = function(user_id, key)
    return vRP.getUData(user_id, key)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- setUserData
-----------------------------------------------------------------------------------------------------------------------------------------
setUserData = function(user_id, key, data)
    vRP.setUData(user_id, key, data)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- getUserData
-----------------------------------------------------------------------------------------------------------------------------------------
getServerData = function(key)
    return vRP.getSData(key)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- sendnotify
-----------------------------------------------------------------------------------------------------------------------------------------
sendnotify = function(source, type, message, time)
    if time == nil then
        time = 5000
    end
    if source then 
        TriggerClientEvent("Notify",source,type,message,time)
    end
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- sendnotify
-----------------------------------------------------------------------------------------------------------------------------------------
senditemnotify = function(source, title, itemname)
    if time == nil then
        time = 5000
    end
    if source then 
        TriggerClientEvent("itensNotify",source,title, itemname)
    end
end